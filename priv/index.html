<html>
  <head>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

      // Load the Visualization API and the corechart package.
      google.charts.load('current', {'packages':['corechart']});

      // Set a callback to run when the Google Visualization API is loaded.
      google.charts.setOnLoadCallback(drawChart);


      // Callback that creates and populates a data table,
      // instantiates the pie chart, passes in the data and
      // draws it.
      function drawChart() {
          $.getJSON("data", function(jdata) {
              var inner = ['Timestamp'];
              var timeseries = {};
              var pids = [];
              var arr = [inner];
              $.each(jdata, function(i, current) {
                  if ($.inArray(current.pid, inner) < 0) {
                      inner.push(current.pid);
                      pids.push(current.pid);
                  }
                  if (!(current.timestamp in timeseries)) {
                      timeseries[current.timestamp] = [current]
                  }
                  else {
                      timeseries[current.timestamp].push(current);
                  }
              });

              $.each(timeseries, function(k, list) {
                  var local = [k];
                  $.each(pids, function(i, pid) {
                      var sz = null;
                      var j = parseInt(k);
                      while (sz == null) {
                          $.each(timeseries[j], function(i, current) {
                            if (current.pid == pid)
                              sz = current.heap_size + current.old_heap_size;
                          });
                          j--;
                          if (j < 0)
                              break;
                      }
                      local.push(sz);
                  });
                  arr.push(local);
              });
              console.log(arr);
              var data = google.visualization.arrayToDataTable(arr);

              // Set chart options
              var options = {'title':'How Much Pizza I Ate Last Night',
                  isStacked : true,
                  interpolateNulls : true,
                  hAxis: {title : 'Time', titleTextStyle : {color : '#00000'}},
                  vAxis: {minValue:0}
              };

              // Instantiate and draw our chart, passing in some options.
              var chart = new google.visualization.AreaChart(document.getElementById('chart_div'));
              chart.draw(data, options);

              google.visualization.events.addListener(chart, 'select', selectHandler);

              function selectHandler() {
                  var arr2 = [['Timestamp', 'Heap Size']];
                  var selection = chart.getSelection();
                  var proc = selection[0].column;

                  for(i = 0; i < data.getNumberOfRows(); ++i) {
                      arr2.push([data.getValue(i, 0), data.getValue(i, proc)]);
                  }

                  var d2 = google.visualization.arrayToDataTable(arr2);
                  var c2 = new google.visualization.AreaChart(document.getElementById('chart_div_2'));
                  c2.draw(d2, options);
              }
          });
      }
    </script>
  </head>

  <body>
    <!--Div that will hold the pie chart-->
    <div id="chart_div"></div>
    <div id="chart_div_2"></div>
  </body>
</html>
